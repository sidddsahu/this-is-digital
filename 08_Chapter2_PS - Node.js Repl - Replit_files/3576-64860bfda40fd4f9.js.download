"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3576],{22862:function(e,r,t){var n=t(35944),o=t(60536),i=t.n(o),a=t(30019),s=t(44781),c=t(6951),u=t(19526),l=t(34193),f=t(81255),p=t(45273);r.Z=function(e){e.devHide;var r=e.eventId,t=e.currentUserImage,o=e.currentUserUsername;return(0,n.tZ)(l.Z,{width:"medium",isOpen:!0,preventClose:!0,onRequestClose:function(){},children:(0,n.BX)("div",{className:i().dynamic([["52051431ebcedd91",[f.n0]]])+" modal-content",children:[(0,n.BX)(u.gC,{spacing:2,align:"center",children:[(0,n.tZ)(a.Z,{level:2,children:" Your Repl is having a bit of trouble."}),(0,n.tZ)("div",{className:i().dynamic([["52051431ebcedd91",[f.n0]]])+" spacer"}),(0,n.tZ)(s.Z,{size:"large",children:"The issue has been logged and the Replit team will look into it. Try reloading the page to get back to coding."}),r&&(0,n.tZ)("div",{css:[f.l0.p(16),f.l0.width("100%"),f.l0.backgroundColor.backgroundHigher,f.l0.borderRadius(8)],className:i().dynamic([["52051431ebcedd91",[f.n0]]]),children:(0,n.BX)(u.gC,{spacing:1,children:[o&&t&&(0,n.BX)(u.Ug,{spacing:2,align:"center",children:[(0,n.tZ)(p.Z,{src:t,username:o,size:48}),(0,n.tZ)(s.Z,{size:"medium",children:o})]}),(0,n.BX)("div",{css:[f.l0.font.code],className:i().dynamic([["52051431ebcedd91",[f.n0]]]),children:["Error: ",r]})]})}),(0,n.tZ)("div",{className:i().dynamic([["52051431ebcedd91",[f.n0]]])+" spacer"}),(0,n.tZ)(c.Z,{onClick:function(){return window.location.reload()},color:"primary",filled:!0,fullWidth:!0,children:"reload"}),!1]}),(0,n.tZ)(i(),{id:"52051431ebcedd91",dynamic:[f.n0],children:".modal-content.__jsx-style-dynamic-selector{padding:var(--space-32)}.sentry-error-embed-wrapper{z-index:".concat(f.n0,"!important}")})]})})}},66223:function(e,r,t){t.d(r,{Z:function(){return H}});var n=t(47568),o=t(26042),i=t(69396),a=t(29815),s=t(34051),c=t.n(s),u=t(65456),l=t(58794),f=t(48551),p=t(15583),d=t(31066),h=t(50055),v=t(4111),m=t(51438),y=t(28668),b=t(10253),k=t(25171),g=t(17187),w=t(34606),x=t(51207),C=t(28173),E=t(7787),D=t(86292),Z=t(35256),F=t(35642),O={replsList:function(){return"dataLossRepls"},replFiles:function(e){return"dataLossReplFiles".concat(e)},latestOp:function(e,r){return"dataLossLatestOp--".concat(e,"--").concat(r)},latestFlushedOp:function(e,r){return"dataLossLatestFlushed--".concat(e,"--").concat(r)},latestOwnOp:function(e,r){return"dataLosslatestOwnOp--".concat(e,"--").concat(r)}};function S(e,r){var t={latestOp:null,latestFlushedOp:null,latestOwnOp:null},n=Object.keys(t),o=!0,i=!1,a=void 0;try{for(var s,c=n[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var u=s.value,l=F.Z.get(O[u](e,r),"object");l&&(l&&"object"===typeof l&&"number"===typeof l.crc32&&"number"===typeof l.version&&(t[u]=l))}}catch(f){i=!0,a=f}finally{try{o||null==c.return||c.return()}finally{if(i)throw a}}return t}function T(){var e=F.Z.get(O.replsList(),"array");return e||(e=[],F.Z.set(O.replsList(),e)),e}function R(e){var r=F.Z.get(O.replFiles(e),"array");return r||(r=[],F.Z.set(O.replFiles(e),r)),r}function _(e){var r=R(e),t=!0,n=!1,o=void 0;try{for(var i,a=r[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var s=i.value;"string"===typeof s&&P(e,s)}}catch(u){n=!0,o=u}finally{try{t||null==a.return||a.return()}finally{if(n)throw o}}F.Z.remove(O.replFiles(e));var c=T().filter((function(r){return r!==e}));F.Z.set(O.replsList(),c)}function P(e,r){F.Z.remove(O.latestOp(e,r)),F.Z.remove(O.latestFlushedOp(e,r)),F.Z.remove(O.latestOwnOp(e,r));var t=R(e).filter((function(e){return e!==r}));F.Z.set(O.replFiles(e),t)}function N(e){var r=e.replId,t=e.filePath;!function(e){var r=T();r.includes(e)||(r.length>20?(_(r[0]),r[0]=e):r.push(e),F.Z.set(O.replsList(),r))}(r);var n=R(r);n.includes(t)||(n.length>20?(_(n[0]),n[0]=t):n.push(t),F.Z.set(O.replFiles(r),n))}function L(e){var r=e.filePath,t=e.replId,n=e.opType,o=e.op;F.Z.set(O[n](t,r),o)}var I={};function B(e){return M.apply(this,arguments)}function M(){return M=(0,n.Z)(c().mark((function e(r){var t,o,i,a,s,u,l;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.filePath,o=r.replId,i=r.serverVersion,a=r.serverContent,s=r.fetchOps,!I[t+o]){e.next=3;break}return e.abrupt("return");case 3:I[t+o]=!0,u=S(o,t),l=w.str(a)>>>0,Object.keys(u).forEach(function(){var e=(0,n.Z)(c().mark((function e(r){var t,n,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=u[r]){e.next=3;break}return e.abrupt("return");case 3:if(!(i<t.version)){e.next=6;break}return E.kg.info("ot client dataloss",{opType:r,case:"server_forgot"}),e.abrupt("return");case 6:if(i!==t.version){e.next=9;break}return l!==t.crc32&&E.kg.info("ot client dataloss",{opType:r,case:"crc32_mistmach"}),e.abrupt("return");case 9:return e.prev=10,e.t0=b.Z,e.next=15,s(t.version,t.version);case 15:e.t1=e.sent,o=(0,e.t0)(e.t1,1),n=o[0],e.next=25;break;case 21:return e.prev=21,e.t2=e.catch(10),E.kg.info("ot client dataloss",{opType:r,case:"error_fetching_op"}),e.abrupt("return");case 25:if(n){e.next=28;break}return E.kg.info("ot client dataloss",{opType:r,case:"op_not_found"}),e.abrupt("return");case 28:n.crc32!==t.crc32&&E.kg.info("ot client dataloss",{opType:r,case:"crc32_mismatch"});case 29:case"end":return e.stop()}}),e,null,[[10,21]])})));return function(r){return e.apply(this,arguments)}}());case 7:case"end":return e.stop()}}),e)}))),M.apply(this,arguments)}var U=t(10449);function V(e,r){var t=!0,n=!1,o=void 0;try{for(var i,a=r[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var s=i.value;switch(s){case u.Df.NotFound:if(e.includes("no such file"))return u.Df.NotFound;if(e.includes("file does not exist"))return u.Df.NotFound;break;case u.Df.AlreadyExists:if(e.includes("file exist"))return u.Df.AlreadyExists;break;case u.Df.NotDirectory:if(e.includes("not a directory"))return u.Df.NotDirectory;break;case u.Df.IsDirectory:if(e.includes("is a directory"))return u.Df.IsDirectory;break;case u.Df.DiskQuotaExceeded:if(e.includes("disk quota exceeded"))return u.Df.DiskQuotaExceeded;break;default:(0,U.Z)(s)}}}catch(c){n=!0,o=c}finally{try{t||null==a.return||a.return()}finally{if(n)throw o}}return null}var j=t(82222),A=t(37756);function Q(e){return e.map((function(e){if("delete"in e&&e.delete)return{d:e.delete};if("skip"in e&&e.skip)return e.skip;if("insert"in e&&"string"===typeof e.insert)return e.insert;throw new Error("Unexpected op type")}))}function q(e,r,t,n,o){var i=[],a=r,s=0,c=function(e){i=t.compose(i,e),a=t.apply(a,e)},u=!0,l=!1,f=void 0;try{for(var p,d=e[Symbol.iterator]();!(u=(p=d.next()).done);u=!0){var h=p.value;switch("undefined"===typeof h?"undefined":(0,j.Z)(h)){case"number":s+=h;break;case"string":var v=n(a,s);c(v>0?[v,h]:[h]),s+=o(h);break;case"object":var m=n(a,s),y=n(a,s+h.d)-m;c(m>0?[m,{d:y}]:[{d:y}]);break;default:throw new Error("unknown op type")}}}catch(b){l=!0,f=b}finally{try{u||null==d.return||d.return()}finally{if(l)throw f}}return[i,a]}var W=function(e){(0,y.Z)(t,e);var r=(0,k.Z)(t);function t(e,a,s){var f;(0,m.Z)(this,t),(f=r.call(this)).writeOp=function(e,r){if(!f.channel&&!f.isReconnecting)throw new Error("Trying to send changes before ever coming online");var t,n,o,i,a;if(f.isReconnecting&&(f.didEditOffline=!0),null===r||void 0===r?void 0:r.isUnicode)t=e,n=x.dt.apply(f.localContent,t);else if(t=(o=(0,b.Z)((i=e,a=f.localContent,q(i,a,x.dt,A.strPosToUni,(function(e){return e.length}))),2))[0],n=o[1],Z.apply(f.localContent,e)!==x.dt.apply(f.localContent,t)){var s={originalError:null,incomingVersion:f.version,uniOp:t,strOp:e};f.onError("unicode and str op mismatch in writeOp",s)}f.localContent=n,f.pending=x.dt.compose(f.pending,t),0!==f.pending.length?f.emit("fileDirty"):f.commitPromise&&f.emit("commitStart"),f.debounceSend()},f.updateCursors=function(e){f.pendingCursors=e,f.debounceSend()},f.isClean=function(){return f.committedVersion===f.version&&0===f.inflight.length&&0===f.pending.length},f.onError=function(e,r){if(r.originalError){var t="string"===typeof r.originalError?r.originalError:r.originalError.message,n=V(t,[u.Df.NotFound,u.Df.IsDirectory,u.Df.DiskQuotaExceeded]);if(n)return void f.emit("fsError",n,t)}f.destroy();var a=new Error("OT Error: "+e);f.emit("error",a,(0,i.Z)((0,o.Z)({},r),{filePath:f.linkedFile,version:f.version}))},f.sendOp=function(){if(f.channel&&"open"===f.channel.status&&!f.isReconnecting&&!(f.inflight.length>0)){if(0!==f.pending.length){var e=f.pending.map((function(e){return"object"===typeof e?{delete:e.d}:"number"===typeof e?{skip:e}:{insert:e}}));f.inflight=f.pending,f.pending=[],f.inflightOpsPromise=f.channel.request({ot:{spookyVersion:f.version,op:e}}),f.inflightOpsPromise.then((function(r){r.error&&f.onError("error accepting packet",{originalError:r.error,op:e})}))}if(0!==f.pendingCursors.length){var r=!0,t=!1,n=void 0;try{for(var i,a=f.flushedCursorIds[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var s=i.value;f.channel.send({otDeleteCursor:{id:s}})}}catch(m){t=!0,n=m}finally{try{r||null==a.return||a.return()}finally{if(t)throw n}}f.flushedCursorIds=[];var c=!0,u=!1,l=void 0;try{for(var p,d=f.pendingCursors[Symbol.iterator]();!(c=(p=d.next()).done);c=!0){var h=p.value,v=Number(Math.random().toString().split(".")[1]).toString(36);f.flushedCursorIds.push(v),f.channel.send({otNewCursor:(0,o.Z)({id:v,user:f.user},h)})}}catch(m){u=!0,l=m}finally{try{c||null==d.return||d.return()}finally{if(u)throw l}}f.pendingCursors=[]}}},f.handlePacket=function(e,r){var t=e.op,n=e.version,o=e.crc32,i=r.overrideReconnectingBuffer;if(!f.isReconnecting||i)if(-1!==f.version){if(f.version++,n!==f.version){var a={originalError:null,expectedVersion:f.version,receivedVersion:n,incomingOp:t};return E.kg.error("OT Error: invalid server version",(0,E.P1)({details:a})),void f.onError("invalid server version",a)}try{f.serverContent=x.dt.apply(f.serverContent,t)}catch(y){return void f.onError("unable to apply updated content",{originalError:y,incomingOp:t})}var s=w.str(f.serverContent)>>>0;if(s!==o){var c={originalError:null,incomingVersion:n,server:o,client:s,incomingOp:t};return E.kg.error("OT Error: crc32 mismatch",(0,E.P1)({details:c})),void f.onError("crc32 mismatch",c)}if(f.uncommittedOps.push({version:n,crc32:o,op:t}),f.shouldTrackDataLoss&&L({replId:f.replId,filePath:f.linkedFile,opType:"latestOp",op:{version:n,crc32:o}}),JSON.stringify(t)===JSON.stringify(f.inflight))return f.shouldTrackDataLoss&&L({replId:f.replId,filePath:f.linkedFile,opType:"latestOwnOp",op:{version:n,crc32:o}}),f.debounceCommit(),f.inflight=[],f.inflightOpsPromise=null,f.debounceSend(),void f.debounceSend.flush();if(f.commitPromise||f.emit("fileDirty"),f.debounceCommit(),f.hasUncommittedMultiplayerOps=!0,f.inflight.length){var u=x.dt.transform(f.inflight,t,"right");t=x.dt.transform(t,f.inflight,"left"),f.inflight=u}if(f.pending.length){var l=x.dt.transform(f.pending,t,"right");t=x.dt.transform(t,f.pending,"left"),f.pending=l}var p,d,h=(0,b.Z)((p=t,d=f.localContent,q(p,d,Z,A.uniToStrPos,A.strPosToUni)),2),v=h[0],m=h[1];Z.apply(f.localContent,v)!==x.dt.apply(f.localContent,t)&&f.onError("unicode and str op mismatch in handlePacket",{originalError:null,incomingVersion:f.version,uniOp:t,strOp:v}),f.localContent=m,f.emit("op",v)}else f.onError("Got packet while version is still -1, expected version to be set in handleStatus",{originalError:null});else f.bufferedReconnectingOps.push({crc32:o,op:t,version:n})},f.handleNewCursor=function(e){f.emit("cursor",e)},f.handleDeleteCursor=function(e){var r=e.id;f.emit("removeCursor",r)};var p=(0,v.Z)(f);f.handleStatus=function(){var e=(0,n.Z)(c().mark((function e(r){var t,n,o,i,a,s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p.channel&&"open"===p.channel.status){e.next=3;break}return e.abrupt("return");case 3:if(!r.linkedFile){e.next=26;break}if(null!=r.contents){e.next=7;break}return p.onError("expected status contents, got null or undefined",{originalError:null}),e.abrupt("return");case 7:if(null!=r.cursors){e.next=10;break}return p.onError("expected status cursors, got null or undefined",{originalError:null}),e.abrupt("return");case 10:if(null!=r.version){e.next=13;break}return p.onError("expected status version, got null or undefined",{originalError:null}),e.abrupt("return");case 13:if(!p.isReconnecting){e.next=16;break}return p.handleReconnect(r.contents,r.version),e.abrupt("return");case 16:return p.shouldTrackDataLoss&&B({serverContent:r.contents,serverVersion:r.version,replId:p.replId,filePath:p.linkedFile,fetchOps:p.fetchOps}),p.serverContent=r.contents,p.localContent=p.serverContent,p.version=r.version,p.emit("firstConnect"),p.emit("op",[p.serverContent]),r.cursors.forEach(p.handleNewCursor),p.emit("fileDirty"),p.debounceCommit(),e.abrupt("return");case 26:return e.next=28,p.channel.request({otLinkFile:{file:{path:p.linkedFile}}});case 28:if(!(n=e.sent).channelClosed){e.next=31;break}return e.abrupt("return");case 31:if(!n.error){e.next=34;break}return p.onError("link file error "+n.error,{originalError:n.error}),e.abrupt("return");case 34:if(n.otLinkFileResponse){e.next=37;break}return p.onError("unexpected link file response: "+JSON.stringify(n.toJSON()),{originalError:null}),e.abrupt("return");case 37:if(o=n.otLinkFileResponse.version,a=l.Z.from(null!==(i=null===(t=n.otLinkFileResponse.linkedFile)||void 0===t?void 0:t.content)&&void 0!==i?i:"").toString(),s=[a],!p.isReconnecting){e.next=44;break}return p.handleReconnect(a,o),e.abrupt("return");case 44:p.shouldTrackDataLoss&&B({serverContent:a,serverVersion:o,replId:p.replId,filePath:p.linkedFile,fetchOps:p.fetchOps}),p.serverContent=a,p.localContent=p.serverContent,p.version=o,p.committedVersion=o,p.committedContent=p.serverContent,p.emit("firstConnect"),p.emit("op",s);case 52:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}();var d=(0,v.Z)(f);f.handleReconnect=function(){var e=(0,n.Z)(c().mark((function e(r,t){var n,a,s,u,l,f,p,h,v,m,y,b,k,g,w,C,E,Z,F,O,S,T,R,_,P,N,L,I,B,M,U,V,j,A,Q,q,W,z,J,X,$,Y,K,G,H,ee,re,te,ne,oe,ie;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d.timeDisconnected){e.next=2;break}throw new Error("wat");case 2:if(n=Date.now()-d.timeDisconnected,a={case:"other",remoteContent:r,localContent:d.localContent},s=function(e){d.reconnectTrackedData=(0,i.Z)((0,o.Z)({},e),{serverVersion:t,ourVersion:d.version,ourCommittedVersion:d.committedVersion,areContentsEqual:d.serverContent===r,areCommittedContentsEqual:d.committedContent===r,didReceiveOpsWhileReconnecting:Boolean(d.bufferedReconnectingOps.length),didEditOffline:d.didEditOffline,hasPendingOps:Boolean(d.pending.length),disconnectDuration:n}),(0,D.j)(D.U3.FILE_RECONNECTED_STATUS2,d.reconnectTrackedData)},u=function(e,r){s({case:e,originCase:e,prompted:!1}),d.isReconnecting=!1,d.bufferedReconnectingOps=[],d.didEditOffline=!1,d.timeDisconnected=null,d.debounceSend(),d.debounceCommit(),d.emit("transparentReconnect",{case:e,originCase:r})},l=function(e){if(a.remoteContent===a.localContent)return d.version=t,d.committedVersion=t,d.localContent=r,d.committedContent=r,d.inflight=[],d.pending=[],void u("unprompted_because_identical",e);s({case:e,prompted:!0}),a.case=e,d.emit("promptUserReconnect",a)},!d.inflight.length){e.next=22;break}if(t!==d.version||d.serverContent!==r){e.next=14;break}return d.pending=x.dt.compose(d.inflight,d.pending),d.inflight=[],d.inflightOpsPromise=null,u("has_inflight_happy_path_ops_unreached"),e.abrupt("return");case 14:f=!1,p=d.serverContent;try{p=x.dt.apply(p,d.inflight)}catch(c){f=!0}if(f||d.version+1!==t||p!==r){e.next=20;break}return l("has_inflight_happy_path_ops_reached"),e.abrupt("return");case 20:return l("has_inflight"),e.abrupt("return");case 22:if(!d.hasUncommittedMultiplayerOps){e.next=25;break}return l("multiplayer"),e.abrupt("return");case 25:if(d.version!==t){e.next=31;break}if(r!==d.serverContent){e.next=29;break}return u("happy_path"),e.abrupt("return");case 29:return l("same_version_different_content"),e.abrupt("return");case 31:if(d.committedVersion!==t){e.next=84;break}for(h=r,e.prev=33,v=!0,m=!1,y=void 0,e.prev=35,b=d.uncommittedOps[Symbol.iterator]();!(v=(k=b.next()).done);v=!0)g=k.value.op,h=x.dt.apply(h,g);e.next=43;break;case 39:e.prev=39,e.t0=e.catch(35),m=!0,y=e.t0;case 43:e.prev=43,e.prev=44,v||null==b.return||b.return();case 46:if(e.prev=46,!m){e.next=49;break}throw y;case 49:return e.finish(46);case 50:return e.finish(43);case 51:e.next=57;break;case 53:return e.prev=53,e.t1=e.catch(33),l("same_committed_version_unable_to_apply_ops"),e.abrupt("return");case 57:if(h!==d.serverContent){e.next=82;break}for(w=[],C=!0,E=!1,Z=void 0,e.prev=60,F=d.uncommittedOps[Symbol.iterator]();!(C=(O=F.next()).done);C=!0)S=O.value.op,w=x.dt.compose(w,S);e.next=68;break;case 64:e.prev=64,e.t2=e.catch(60),E=!0,Z=e.t2;case 68:e.prev=68,e.prev=69,C||null==F.return||F.return();case 71:if(e.prev=71,!E){e.next=74;break}throw Z;case 74:return e.finish(71);case 75:return e.finish(68);case 76:return d.pending=x.dt.compose(w,d.pending),d.uncommittedOps=[],d.version=t,d.serverContent=r,u("happy_path_uncommitted"),e.abrupt("return");case 82:return l("same_committed_version_different_content_fixed"),e.abrupt("return");case 84:if(!(d.version<t)){e.next=183;break}return e.next=87,d.fetchOps(d.version+1,t);case 87:for(T=e.sent,R=!1,_=d.serverContent,e.prev=90,P=!0,N=!1,L=void 0,e.prev=92,I=T[Symbol.iterator]();!(P=(B=I.next()).done);P=!0)M=B.value.op,_=x.dt.apply(_,M);e.next=100;break;case 96:e.prev=96,e.t3=e.catch(92),N=!0,L=e.t3;case 100:e.prev=100,e.prev=101,P||null==I.return||I.return();case 103:if(e.prev=103,!N){e.next=106;break}throw L;case 106:return e.finish(103);case 107:return e.finish(100);case 108:e.next=113;break;case 110:e.prev=110,e.t4=e.catch(90),R=!0;case 113:if(R||_!==r){e.next=150;break}for(U=!0,V=!1,j=void 0,e.prev=115,A=T[Symbol.iterator]();!(U=(Q=A.next()).done);U=!0)q=Q.value,d.handlePacket(q,{overrideReconnectingBuffer:!0});e.next=123;break;case 119:e.prev=119,e.t5=e.catch(115),V=!0,j=e.t5;case 123:e.prev=123,e.prev=124,U||null==A.return||A.return();case 126:if(e.prev=126,!V){e.next=129;break}throw j;case 129:return e.finish(126);case 130:return e.finish(123);case 131:for(W=!0,z=!1,J=void 0,e.prev=132,X=d.bufferedReconnectingOps[Symbol.iterator]();!(W=($=X.next()).done);W=!0)Y=$.value,d.handlePacket(Y,{overrideReconnectingBuffer:!0});e.next=140;break;case 136:e.prev=136,e.t6=e.catch(132),z=!0,J=e.t6;case 140:e.prev=140,e.prev=141,W||null==X.return||X.return();case 143:if(e.prev=143,!z){e.next=146;break}throw J;case 146:return e.finish(143);case 147:return e.finish(140);case 148:return u("happy_path_server_ahead"),e.abrupt("return");case 150:return e.next=152,d.fetchOps(d.committedVersion+1,t);case 152:for(K=e.sent,G=!1,H=d.committedContent,e.prev=155,ee=!0,re=!1,te=void 0,e.prev=157,ne=K[Symbol.iterator]();!(ee=(oe=ne.next()).done);ee=!0)ie=oe.value.op,H=x.dt.apply(H,ie);e.next=165;break;case 161:e.prev=161,e.t7=e.catch(157),re=!0,te=e.t7;case 165:e.prev=165,e.prev=166,ee||null==ne.return||ne.return();case 168:if(e.prev=168,!re){e.next=171;break}throw te;case 171:return e.finish(168);case 172:return e.finish(165);case 173:e.next=178;break;case 175:e.prev=175,e.t8=e.catch(155),G=!0;case 178:if(G||H!==r){e.next=181;break}return l("happy_path_uncommitted_server_ahead"),e.abrupt("return");case 181:return l("uncommitted_server_ahead"),e.abrupt("return");case 183:l("other");case 184:case"end":return e.stop()}}),e,null,[[33,53],[35,39,43,51],[44,,46,50],[60,64,68,76],[69,,71,75],[90,110],[92,96,100,108],[101,,103,107],[115,119,123,131],[124,,126,130],[132,136,140,148],[141,,143,147],[155,175],[157,161,165,173],[166,,168,172]])})));return function(r,t){return e.apply(this,arguments)}}();var h=(0,v.Z)(f);f.flush=(0,n.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.commitPromise;case 2:return h.debounceCommit(),h.debounceCommit.flush(),e.next=6,h.commitPromise;case 6:case"end":return e.stop()}}),e)})));var y=(0,v.Z)(f);f.fetchOps=function(){var e=(0,n.Z)(c().mark((function e(r,t){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(y.channel){e.next=2;break}throw new Error("No channel, cannot fetchOps");case 2:return e.next=4,y.channel.request({otFetchRequest:{versionFrom:r,versionTo:t}});case 4:if(!(n=e.sent).channelClosed){e.next=7;break}throw new Error("Channel closed while requesting");case 7:if(!n.error){e.next=9;break}throw new Error("Fetch ops returned an error: "+n.error);case 9:if(n.otFetchResponse){e.next=11;break}throw new Error("Expected otFetchResponse");case 11:if(n.otFetchResponse.packets){e.next=13;break}throw new Error("Expected otFetchResponse.packets");case 13:return e.abrupt("return",n.otFetchResponse.packets.map((function(e){var r=e.crc32,t=e.op,n=e.version,o=e.userId,i=e.committed;if(null==r)throw new Error("Expected crc32 in packet");if(null==t)throw new Error("Expected op in packet");if(null==n)throw new Error("Expected version in packet");return{crc32:r,version:n,op:Q(t),userId:o,timestamp:i?1e3*i.seconds:0}})));case 14:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}();var k=(0,v.Z)(f);f.transformSelection=function(){var e=(0,n.Z)(c().mark((function e(r){var t,n,o,i,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.indexStart,n=r.indexEnd,o=r.versionFrom,i=r.versionTo,k.channel){e.next=3;break}throw new Error("No channel, cannot transformSelection");case 3:return e.next=5,k.channel.request({otTransformSelectionRequest:{indexStart:t,indexEnd:n,versionFrom:o,versionTo:i}});case 5:if((a=e.sent).otTransformSelectionResponse){e.next=8;break}throw new Error("Expected otTransformSelectionResponse");case 8:return e.abrupt("return",a.otTransformSelectionResponse);case 9:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),f.shouldTrackDataLoss=!1,f.replId="",f.linkedFile=e,f.channel=null,f.inflight=[],f.inflightOpsPromise=null,f.uncommittedOps=[],f.hasUncommittedMultiplayerOps=!1,f.committedVersion=-1,f.isReconnecting=!1,f.bufferedReconnectingOps=[],f.didEditOffline=!1,f.pending=[],f.version=-1,f.serverContent="",f.localContent="",f.committedContent="",f.flushedCursorIds=[],f.pendingCursors=[],f.user=null,f.flushFailed=0,f.debounceSend=(0,C.Z)((function(){return f.sendOp()}),20,{maxWait:60}),f.debounceCommit=(0,C.Z)((function(){return f.commitToDisk()}),1e3,{maxWait:3e3}),f.commitPromise=null,f.timeDisconnected=null;var g=!1;return f.destroy=function(){g=!0},s.then((function(){g||(f.destroy=a.openChannel({service:"ot",name:"ot:".concat(e)},(function(r){if(!r.error){var t=r.channel,n=r.context;if(f.user=n.currentUser?{name:n.currentUser.username,id:n.currentUser.id}:null,n.currentUser&&n.repl){var o=window.navigator.userAgent.includes("Firefox");f.shouldTrackDataLoss=n.currentUser.flagTrackOtClientDataLoss&&!o,f.replId=n.repl.id,f.shouldTrackDataLoss&&N({replId:f.replId,filePath:e})}return f.channel=t,t.onCommand((function(e){switch(e.body){case"ot":var r,t,n;if(!e.ot||null==e.ot.op||null==e.ot.spookyVersion||null==e.ot.crc32)return void f.onError("missing data in ot packet",{originalError:null,op:null===(r=e.ot)||void 0===r?void 0:r.op,spookyVersion:null===(t=e.ot)||void 0===t?void 0:t.spookyVersion,crc32:null===(n=e.ot)||void 0===n?void 0:n.crc32});if(-1===f.version)return;var o={crc32:e.ot.crc32,op:Q(e.ot.op),version:e.ot.spookyVersion};return f.handlePacket(o,{overrideReconnectingBuffer:!1});case"otstatus":return f.handleStatus(e.otstatus);case"error":if(e.ref)return;return f.onError("Unknown protocol error OT channel",{originalError:e.error||"no error"});case"otNewCursor":return f.handleNewCursor(e.otNewCursor);case"otDeleteCursor":return f.handleDeleteCursor(e.otDeleteCursor)}})),function(){f.channel=null,f.isReconnecting=!0,f.debounceSend.cancel(),f.debounceCommit.cancel(),f.timeDisconnected||(f.timeDisconnected=Date.now())}}})))})),f}return t.prototype.commitToDisk=function(){var e=this;return(0,n.Z)(c().mark((function r(){var t,n,o,i,a;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e.channel){r.next=2;break}throw new Error("Tryna commit while offline");case 2:if("open"===e.channel.status){r.next=4;break}return r.abrupt("return");case 4:if(!e.isReconnecting){r.next=6;break}throw new Error("Committing while reconnecting");case 6:if(!e.isClean()){r.next=8;break}return r.abrupt("return");case 8:if(!e.commitPromise){r.next=11;break}return e.debounceCommit(),r.abrupt("return");case 11:if(t=function(){},e.commitPromise=new Promise((function(e){return t=e})),!e.inflightOpsPromise){r.next=21;break}return r.next=16,e.inflightOpsPromise;case 16:if(!r.sent.channelClosed){r.next=21;break}return e.commitPromise=null,t(),r.abrupt("return");case 21:if(!(e.pending.length>0)){r.next=36;break}if(e.debounceSend(),e.debounceSend.flush(),e.inflightOpsPromise){r.next=29;break}return e.commitPromise=null,t(),e.onError("expected inflight promise",{originalError:null}),r.abrupt("return");case 29:return r.next=31,e.inflightOpsPromise;case 31:if(!r.sent.channelClosed){r.next=36;break}return e.commitPromise=null,t(),r.abrupt("return");case 36:return e.emit("commitStart"),n=e.version,o=e.serverContent,r.next=41,e.channel.request({flush:{}});case 41:if(!(i=r.sent).channelClosed){r.next=47;break}return e.flushFailed=0,e.commitPromise=null,t(),r.abrupt("return");case 47:if("ok"===i.body){r.next=57;break}if(e.commitPromise=null,t(),e.flushFailed++,3,!(e.flushFailed<3)){r.next=55;break}return e.debounceCommit(),r.abrupt("return");case 55:return e.onError("unable to flush",{originalError:i.error||i.toString()}),r.abrupt("return");case 57:return e.shouldTrackDataLoss&&(a=e.uncommittedOps[e.uncommittedOps.length-1])&&L({replId:e.replId,filePath:e.linkedFile,op:{crc32:a.crc32,version:a.version},opType:"latestFlushedOp"}),e.uncommittedOps=[],e.hasUncommittedMultiplayerOps=!1,e.committedVersion=n,e.committedContent=o,e.flushFailed=0,e.emit("commitComplete",n),e.isClean()&&e.emit("fileClean"),e.commitPromise=null,t(),r.abrupt("return",i);case 68:case"end":return r.stop()}}),r)})))()},t}(g.EventEmitter),z=W,J=t(84810),X=t(15519),$=t(92876),Y=t(37053),K=t(27135);function G(e){for(var r=arguments.length,t=new Array(r>1?r-1:0),n=1;n<r;n++)t[n-1]=arguments[n];return new Promise((function(r,n){setTimeout((function(){e.apply(void 0,(0,a.Z)(t)).then(r).catch(n)}),0)}))}function H(e){var r,t=e.container,s=function(e){M.push(e),I(),e.then((function(){var r=M.indexOf(e);r>-1&&M.splice(r,1),N()}))},v=function(e){var r=!0,t=!1,n=void 0;try{for(var o,i=F[Symbol.iterator]();!(r=(o=i.next()).done);r=!0){(0,o.value)(e)}}catch(a){t=!0,n=a}finally{try{r||null==i.return||i.return()}finally{if(t)throw n}}},m=function(e){if(e.startsWith("/home/runner"))throw new Error("watchOtFile requires relative paths");var r=new z(e,t,Promise.all((0,a.Z)(M).map((function(e){return e.catch((function(){}))}))).then((function(){})));return r.on("commitComplete",N),r.on("fileDirty",I),r.on("fileClean",I),r.on("commitStart",I),r},y=null,b=null,k=null,g=0,x=new Map,C=new Map,E=new Map,F=[];t.openChannel({service:"fsevents"},(function(e){var r=e.error,t=e.channel;if(!r){if(!t)throw new Error("Expected channel");y=t,t.onCommand((function(e){if("fileEvent"===e.body){if(!e.fileEvent)throw new Error("Expected fileEvent");var r=e.fileEvent,t=r.file,n=r.dest,o=r.op;if(t){var i=t.path;if(null!==i&&null!==o&&void 0!==i&&void 0!==o){var a;if(N(),x.get(i)||t.type===h.api.File.Type.DIRECTORY)a=u.Tv.Directory;else{var s,c=Array.from(x.keys()).find((function(e){return(0,p.pC)(e,i)})),l=c&&(null===(s=x.get(c))||void 0===s?void 0:s.children.find((function(e){return e.filename===(0,f.UO)(i)})));a=l?l.type:u.Tv.File}switch(o){case h.api.FileEvent.Op.Create:A({eventType:u.kS.Create,node:{path:i,type:a}});break;case h.api.FileEvent.Op.Modify:if(a===u.Tv.Directory)break;A({eventType:u.kS.Modify,node:{path:i,type:a}});break;case h.api.FileEvent.Op.Remove:A({eventType:u.kS.Delete,node:{path:i,type:a}});break;case h.api.FileEvent.Op.Move:if(null==n||null==n.path)throw new Error("Expected dest path");var d=n.path;A({eventType:u.kS.Move,node:{path:i,type:a},to:d})}}}}}));var n=(0,a.Z)(new Set((0,a.Z)(x.keys()).concat((0,a.Z)(C.keys()),(0,a.Z)(E.keys()))));return n.length&&t.send({subscribeFile:{files:n.map((function(e){return{path:e}}))}}),function(){y=null}}}));var O=new Promise((function(e){return r=e}));t.openChannel({service:function(e){return e.repl.currentUserPermissions.containerWrite?"gcsfiles":"files"}},(function(e){var t=e.error,n=e.channel;if(!t){if(!n)throw new Error("Expected channel");r(n);var o=(0,a.Z)(x.keys()).sort(),i=!0,s=!1,c=void 0;try{for(var l,f=function(){var e=l.value;H.readDir(e).then((function(r){var t=x.get(e);if(t)if(r.error)A({eventType:u.kS.Delete,node:{path:e,type:u.Tv.Directory}});else{var n=r.children,o=t.children,i=o.filter((function(e){return!n.some((function(r){return r.filename===e.filename&&r.type===e.type}))})),a=!0,s=!1,c=void 0;try{for(var l,f=i[Symbol.iterator]();!(a=(l=f.next()).done);a=!0){var p=l.value;A({eventType:u.kS.Delete,node:{path:e===d.Ql?p.filename:e+"/"+p.filename,type:p.type}})}}catch(w){s=!0,c=w}finally{try{a||null==f.return||f.return()}finally{if(s)throw c}}var h=n.filter((function(e){return!o.some((function(r){return r.filename===e.filename&&r.type===e.type}))})),v=!0,m=!1,y=void 0;try{for(var b,k=h[Symbol.iterator]();!(v=(b=k.next()).done);v=!0){var g=b.value;A({eventType:u.kS.Create,node:{path:e===d.Ql?g.filename:e+"/"+g.filename,type:g.type}})}}catch(w){m=!0,y=w}finally{try{v||null==k.return||k.return()}finally{if(m)throw y}}}}))},p=o[Symbol.iterator]();!(i=(l=p.next()).done);i=!0)f()}catch(g){s=!0,c=g}finally{try{i||null==p.return||p.return()}finally{if(s)throw c}}var h=!0,v=!1,m=void 0;try{for(var y,b=function(){var e=y.value;H.readFile(e,{fromDisk:!0}).then((function(r){var t=E.get(e);t&&(r.error?A({eventType:u.kS.Delete,node:{path:e,type:u.Tv.File}}):r.content.toBuffer().equals(t.latestContent.toBuffer())||A({eventType:u.kS.Modify,node:{path:e,type:u.Tv.File}}))}))},k=E.keys()[Symbol.iterator]();!(h=(y=k.next()).done);h=!0)b()}catch(g){v=!0,m=g}finally{try{h||null==k.return||k.return()}finally{if(v)throw m}}return function(){O=new Promise((function(e){return r=e}))}}}));var S=(0,K.Z)();S.promise.catch((function(e){return e}));var T=(0,Y.Z)((0,n.Z)(c().mark((function e(){var r,t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.promise;case 2:return r=e.sent,e.next=5,r.request({fsSnapshot:{}});case 5:if(!(t=e.sent).channelClosed){e.next=8;break}return e.abrupt("return",{success:!1,error:"channel closed"});case 8:if(!t.error){e.next=10;break}return e.abrupt("return",{success:!1,error:t.error});case 10:return e.abrupt("return",{error:null,success:!0});case 11:case"end":return e.stop()}}),e)}))),{wait:5e3,maxWait:1e4});t.openChannel({service:"snapshot",skip:function(e){return!e.repl.currentUserPermissions.containerWrite}},(function(e){var r=e.error,t=e.channel;if(!r){if(!t)throw new Error("Expected channel");return S.resolve(t),function(){S.isFulfilled&&(S=(0,K.Z)()).promise.catch((function(e){return e}))}}S.isFulfilled||S.reject(r)}));var R=u.kO.Clean,_=[],P=0;function N(){return L.apply(this,arguments)}function L(){return(L=(0,n.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return P++,I(),e.next=4,H.persist();case 4:P--,I();case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(){return B.apply(this,arguments)}function B(){return(B=(0,n.Z)(c().mark((function e(){var r,t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=0===P&&0===M.length&&Array.from(C.values()).every((function(e){return e.otClient.isClean()})),t=R===u.kO.Clean,r!==t){e.next=4;break}return e.abrupt("return");case 4:R=r?u.kO.Clean:u.kO.Syncing,_.forEach((function(e){e(R)}));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var M=[];function U(e,r){return j.apply(this,arguments)}function j(){return j=(0,n.Z)(c().mark((function e(r,t){var o,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=function(){var e=(0,n.Z)(c().mark((function e(){var t,n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O;case 2:if("open"===(t=e.sent).status){e.next=5;break}return e.abrupt("return",G(o));case 5:return e.next=7,t.request(r);case 7:if(!(n=e.sent).channelClosed){e.next=10;break}return e.abrupt("return",G(o));case 10:return e.abrupt("return",n);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),i=o(),t.isMutative&&s(i),e.abrupt("return",i);case 4:case"end":return e.stop()}}),e)}))),j.apply(this,arguments)}function A(e){k=null;var r=e.node.path.includes("/")?(0,f.Il)(e.node.path):d.Ql,t=x.get(r),n=(0,f.UO)(e.node.path);if(!n)throw new Error("Expected filename");var s=null;if(e.eventType===u.kS.Move){var c=e.to.includes("/")?(0,f.Il)(e.to):d.Ql;s=x.get(c)}if(t||s)switch(e.eventType){case u.kS.Create:if(!t)break;var l=(0,a.Z)(t.children.filter((function(e){return e.filename!==n}))).concat([{type:e.node.type,filename:n}]),h=!0,v=!1,m=void 0;try{for(var y,b=t.listeners[Symbol.iterator]();!(h=(y=b.next()).done);h=!0){(0,y.value.onChange)(l)}}catch(xe){v=!0,m=xe}finally{try{h||null==b.return||b.return()}finally{if(v)throw m}}t.children=l;break;case u.kS.Move:var g=(0,f.UO)(e.to);if(t&&t===s){var w=(0,a.Z)(t.children.filter((function(e){return e.filename!==n&&e.filename!==g}))).concat([{type:e.node.type,filename:g}]),D=!0,Z=!1,F=void 0;try{for(var O,S=t.listeners[Symbol.iterator]();!(D=(O=S.next()).done);D=!0){(0,O.value.onChange)(w)}}catch(xe){Z=!0,F=xe}finally{try{D||null==S.return||S.return()}finally{if(Z)throw F}}t.children=w;break}if(t){var T=t.children.filter((function(e){return e.filename!==n})),R=!0,_=!1,P=void 0;try{for(var N,L=t.listeners[Symbol.iterator]();!(R=(N=L.next()).done);R=!0){(0,N.value.onChange)(T)}}catch(xe){_=!0,P=xe}finally{try{R||null==L.return||L.return()}finally{if(_)throw P}}t.children=T}if(s){var I=(0,a.Z)(s.children.filter((function(e){return e.filename!==n&&e.filename!==g}))).concat([{type:e.node.type,filename:g}]),B=!0,M=!1,U=void 0;try{for(var V,j=s.listeners[Symbol.iterator]();!(B=(V=j.next()).done);B=!0){(0,V.value.onChange)(I)}}catch(xe){M=!0,U=xe}finally{try{B||null==j.return||j.return()}finally{if(M)throw U}}s.children=I}break;case u.kS.Delete:if(!t)break;var Q=t.children.filter((function(e){return e.filename!==n})),q=!0,W=!1,z=void 0;try{for(var J,X=t.listeners[Symbol.iterator]();!(q=(J=X.next()).done);q=!0){(0,J.value.onChange)(Q)}}catch(xe){W=!0,z=xe}finally{try{q||null==X.return||X.return()}finally{if(W)throw z}}t.children=Q;break;case u.kS.Modify:break;default:throw new Error("unknown event")}switch(e.eventType){case u.kS.Move:case u.kS.Delete:var Y=[C.get(e.node.path),E.get(e.node.path),x.get(e.node.path)],K=!0,G=!1,ee=void 0;try{for(var re,te=Y[Symbol.iterator]();!(K=(re=te.next()).done);K=!0){var ne=re.value;if(ne){var oe=!0,ie=!1,ae=void 0;try{for(var se,ce=ne.listeners[Symbol.iterator]();!(oe=(se=ce.next()).done);oe=!0){var ue=se.value,le=ue.onMoveOrDelete,fe=ue.dispose;le&&le(e),fe()}}catch(xe){ie=!0,ae=xe}finally{try{oe||null==ce.return||ce.return()}finally{if(ie)throw ae}}}}}catch(xe){G=!0,ee=xe}finally{try{K||null==te.return||te.return()}finally{if(G)throw ee}}if(e.node.type===u.Tv.File)break;var pe=(0,a.Z)(new Set((0,a.Z)(x.keys()).concat((0,a.Z)(E.keys()),(0,a.Z)(C.keys())))).map((function(e){var r=C.get(e)||E.get(e)||x.get(e);if(!r)throw new Error("expected node");return r})),de=[],he=!0,ve=!1,me=void 0;try{for(var ye,be=pe.sort()[Symbol.iterator]();!(he=(ye=be.next()).done);he=!0){var ke=ye.value;if((0,p.yr)(e.node.path,ke.path)){var ge=de.slice(-1)[0];if(!ge||!(0,p.yr)(ge,ke.path)){var we={eventType:u.kS.Delete,node:{path:ke.path,type:ke.type}};e.eventType===u.kS.Move&&(we=(0,i.Z)((0,o.Z)({},we),{eventType:u.kS.Move,to:(0,p.hk)(e.node.path,e.to,ke.path)})),de.push(ke.path),A(we)}}}}catch(xe){ve=!0,me=xe}finally{try{he||null==be.return||be.return()}finally{if(ve)throw me}}break;case u.kS.Create:case u.kS.Modify:if(!E.has(e.node.path))break;H.readFile(e.node.path,{fromDisk:!0}).then((function(r){var t=E.get(e.node.path);if(t)if(r.error)A({eventType:u.kS.Delete,node:{path:e.node.path,type:u.Tv.File}});else{t.latestContent=r.content;var n=!0,o=!1,i=void 0;try{for(var a,s=t.listeners[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var c=a.value.onChange;c&&c(r.content)}}catch(xe){o=!0,i=xe}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}}})).catch((function(e){e.message="File read after modify error: "+e.message,$.Tb(e)}))}}function Q(){return q.apply(this,arguments)}function q(){return(q=(0,n.Z)(c().mark((function e(){var r,n,o,i,s,u,l,f,p,d;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=null===(n=t.getContext())||void 0===n||null===(o=n.repl)||void 0===o?void 0:o.language){e.next=5;break}throw new Error("Expected repl language");case 5:return s=window.performance.now(),e.next=8,(r=t).exec.apply(r,["ag","--noaffinity","-g *","--hidden"].concat((0,a.Z)(J.h.map((function(e){return"--ignore=".concat(e)})))));case 8:if(u=e.sent,l=u.output,f=u.error,(0,D.j)(D.U3.LIST_FILES_EXECUTED,{duration:window.performance.now()-s,failed:Boolean(f)&&"exit status 1"!==f}),p=function(e){return!!e&&(!(0,J.C)(e)&&!X.Z.isLangFileBinary(i,e))},f||!l){e.next=16;break}return k={error:null,files:l.split("\n").filter(p)},e.abrupt("return",k);case 16:if(!f||!f.includes("not found")){e.next=24;break}return e.next=19,t.exec("find",".","-type","f","-print0");case 19:if(d=e.sent,(0,D.j)(D.U3.AG_NOT_AVAILABLE,{language:i}),!d.output){e.next=24;break}return k={error:null,files:d.output.slice(2,-1).split("\0./").filter(p)},e.abrupt("return",k);case 24:return"exit status 1"!==f&&$.Tb(new Error("Find file command failed with error: ".concat(f))),e.abrupt("return",{error:f,files:null});case 26:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var W=function(){var e=(0,n.Z)(c().mark((function e(r,t,o){var i,a,s,l,f,p,d,h,m;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(e){return s.apply(this,arguments)},s=function(){return s=(0,n.Z)(c().mark((function e(r){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.request(r);case 2:if(!(t=e.sent).channelClosed){e.next=5;break}throw new Error("channelClosed");case 5:if(!t.error){e.next=7;break}throw new Error(t.error);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)}))),s.apply(this,arguments)},e.next=4,O;case 4:return i=e.sent,l={eventType:u.kS.Create,node:{path:r,type:u.Tv.File}},e.prev=8,e.next=11,a({transferStart:{path:r,size:t.length}});case 11:if(f=e.sent.transfer){e.next=14;break}throw new Error("Failed to start a transfer (no transfer id)");case 14:p=t.toBuffer(),d=512e3,o(p.length,0),h=0;case 18:if(!(h<Math.ceil(t.length/d))){e.next=25;break}return e.next=21,a({transferChunk:{id:f.id,content:p.subarray(h*d,(h+1)*d)}});case 21:o(p.length,Math.min(p.length,(h+1)*d));case 22:h++,e.next=18;break;case 25:return e.next=27,a({transferComplete:{id:f.id,crc32:w.buf(p)}});case 27:e.next=39;break;case 29:if(e.prev=29,e.t0=e.catch(8),"channelClosed"!==e.t0.message){e.next=33;break}return e.abrupt("return",G(H.transferFile,r,t,o));case 33:if((m=V(e.t0.message,[u.Df.NotDirectory,u.Df.AlreadyExists,u.Df.DiskQuotaExceeded]))===u.Df.DiskQuotaExceeded&&v(l),m===u.Df.AlreadyExists&&(m=u.Df.IsDirectory),!m){e.next=38;break}return e.abrupt("return",{error:m});case 38:throw e.t0;case 39:return A(l),e.abrupt("return",{error:null});case 41:case"end":return e.stop()}}),e,null,[[8,29]])})));return function(r,t,n){return e.apply(this,arguments)}}(),H={getStatus:function(){return R},onStatusChange:function(e){return _.push(e),function(){var r=_.indexOf(e);r>-1&&_.splice(r,1)}},watchDir:function(e,r){var t=!1,n=function(){t=!0;var r=x.get(e);r&&(r.listeners=r.listeners.filter((function(e){return e.dispose!==n})),0===r.listeners.length&&x.delete(e))};return H.readDir(e).then((function(a){if(!t){if(a.error){var s=new Error(a.error);return s.code=a.error,r.onError(s),void n()}var c=x.get(e);c||(c={path:e,type:u.Tv.Directory,children:a.children,listeners:[]},x.set(e,c),y&&y.send({subscribeFile:{files:[{path:e}]}})),c.listeners.push((0,i.Z)((0,o.Z)({},r),{dispose:n})),r.onChange(a.children)}})).catch((function(e){n(),r.onError(e)})),n},writeFile:function(e,r){return(0,n.Z)(c().mark((function t(){var n,o,i,a,s,p;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o="string"===typeof r?l.Z.from(r).toBuffer():r.toBuffer(),t.next=5,U({write:{path:e,content:o}},{isMutative:!0});case 5:if(i=t.sent,s=null===(n=x.get((0,f.Il)(e)))||void 0===n?void 0:n.children.some((function(r){return r.filename===(0,f.UO)(e)})),a=E.has(e)||C.has(e)||s?{eventType:u.kS.Modify,node:{path:e,type:u.Tv.File}}:{eventType:u.kS.Create,node:{path:e,type:u.Tv.File}},!i.error){t.next=16;break}if((p=V(i.error,[u.Df.NotDirectory,u.Df.AlreadyExists,u.Df.DiskQuotaExceeded]))===u.Df.DiskQuotaExceeded&&v(a),p===u.Df.AlreadyExists&&(p=u.Df.IsDirectory),p){t.next=15;break}throw new Error(i.error);case 15:return t.abrupt("return",{error:p});case 16:return A(a),t.abrupt("return",{error:null});case 18:case"end":return t.stop()}}),t)})))()},transferFile:function(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,n.Z)(c().mark((function e(){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=W.apply(void 0,(0,a.Z)(r)),s(t),e.abrupt("return",t);case 3:case"end":return e.stop()}}),e)})))()},readFile:function(e){var r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{fromDisk:!1}).fromDisk;return(0,n.Z)(c().mark((function t(){var n,o,i,a;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r){t.next=7;break}if(!(n=C.get(e))||!n.otClient.localContent||n.otClient.isReconnecting){t.next=4;break}return t.abrupt("return",{content:l.Z.from(n.otClient.localContent),error:null});case 4:if(!(o=E.get(e))){t.next=7;break}return t.abrupt("return",{content:o.latestContent,error:null});case 7:return t.next=9,U({read:{path:e}},{isMutative:!1});case 9:if(!(i=t.sent).error){t.next=15;break}if(a=V(i.error,[u.Df.NotFound,u.Df.IsDirectory])){t.next=14;break}throw new Error(i.error);case 14:return t.abrupt("return",{error:a});case 15:if(i.file&&i.file.path&&i.file.content){t.next=17;break}throw new Error("Expected file");case 17:return t.abrupt("return",{content:l.Z.from(i.file.content),error:null});case 18:case"end":return t.stop()}}),t)})))()},createDir:function(e){return(0,n.Z)(c().mark((function r(){var t,n,o;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,U({mkdir:{path:e}},{isMutative:!0});case 2:if(t=r.sent,n={eventType:u.kS.Create,node:{path:e,type:u.Tv.Directory}},!t.error){r.next=10;break}if((o=V(t.error,[u.Df.NotDirectory,u.Df.DiskQuotaExceeded]))===u.Df.DiskQuotaExceeded&&v(n),o){r.next=9;break}throw new Error(t.error);case 9:return r.abrupt("return",{error:o});case 10:return A(n),r.abrupt("return",{error:null});case 12:case"end":return r.stop()}}),r)})))()},moveDir:function(e,r){return(0,n.Z)(c().mark((function t(){var n,o,i;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,U({move:{oldPath:e,newPath:r}},{isMutative:!0});case 2:if(n=t.sent,o={eventType:u.kS.Move,node:{path:e,type:u.Tv.Directory},to:r},!n.error){t.next=10;break}if((i=V(n.error,[u.Df.NotFound,u.Df.AlreadyExists,u.Df.NotDirectory,u.Df.DiskQuotaExceeded]))===u.Df.DiskQuotaExceeded&&v(o),i){t.next=9;break}throw new Error(n.error);case 9:return t.abrupt("return",{error:i});case 10:return A(o),t.abrupt("return",{error:null});case 12:case"end":return t.stop()}}),t)})))()},moveFile:function(e,r){return(0,n.Z)(c().mark((function t(){var n,o,i;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,U({move:{oldPath:e,newPath:r}},{isMutative:!0});case 2:if(n=t.sent,o={eventType:u.kS.Move,node:{path:e,type:u.Tv.File},to:r},!n.error){t.next=10;break}if((i=V(n.error,[u.Df.NotFound,u.Df.AlreadyExists,u.Df.NotDirectory,u.Df.DiskQuotaExceeded]))===u.Df.DiskQuotaExceeded&&v(o),i){t.next=9;break}throw new Error(n.error);case 9:return t.abrupt("return",{error:i});case 10:return A(o),t.abrupt("return",{error:null});case 12:case"end":return t.stop()}}),t)})))()},copyFile:function(e,r){return(0,n.Z)(c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,H.readFile(e);case 2:if(!(n=t.sent).error){t.next=5;break}return t.abrupt("return",n);case 5:return t.abrupt("return",H.writeFile(r,n.content));case 6:case"end":return t.stop()}}),t)})))()},copyDirFromRemote:function(e,r,t){return(0,n.Z)(c().mark((function n(){var o,i,a,s,l,f,p,d,h,v,m,y;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.deleteDir(e);case 2:return n.next=4,t.readDir(e);case 4:if(!(o=n.sent).error){n.next=7;break}return n.abrupt("return",o);case 7:return n.next=9,this.readDir(r);case 9:if((i=n.sent).error!==u.Df.NotFound){n.next=15;break}return n.next=13,this.createDir(e);case 13:n.next=17;break;case 15:if(i.error!==u.Df.NotDirectory){n.next=17;break}return n.abrupt("return",i);case 17:a=!0,s=!1,l=void 0,n.prev=18,f=o.children[Symbol.iterator]();case 20:if(a=(p=f.next()).done){n.next=45;break}if(d=p.value,h="".concat(e,"/").concat(d.filename),d.type!==u.Tv.File){n.next=36;break}return n.next=26,t.readFile(h);case 26:if(!(v=n.sent).error){n.next=29;break}return n.abrupt("return",v);case 29:return n.next=31,this.writeFile("".concat(r,"/").concat(d.filename),v.content);case 31:if(!(m=n.sent).error){n.next=34;break}return n.abrupt("return",m);case 34:n.next=42;break;case 36:if(d.type!==u.Tv.Directory){n.next=42;break}return n.next=39,this.copyDirFromRemote(h,"".concat(r,"/").concat(d.filename),t);case 39:if(!(y=n.sent).error){n.next=42;break}return n.abrupt("return",y);case 42:a=!0,n.next=20;break;case 45:n.next=51;break;case 47:n.prev=47,n.t0=n.catch(18),s=!0,l=n.t0;case 51:n.prev=51,n.prev=52,a||null==f.return||f.return();case 54:if(n.prev=54,!s){n.next=57;break}throw l;case 57:return n.finish(54);case 58:return n.finish(51);case 59:return n.abrupt("return",{error:null});case 60:case"end":return n.stop()}}),n,this,[[18,47,51,59],[52,,54,58]])}))).apply(this)},copyFileFromRemote:function(e,r,t){return(0,n.Z)(c().mark((function n(){var o,i;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.readFile(e);case 2:if(!(o=n.sent).error){n.next=5;break}return n.abrupt("return",o);case 5:return n.next=7,this.writeFile(r,o.content);case 7:if(!(i=n.sent).error){n.next=10;break}return n.abrupt("return",i);case 10:return n.abrupt("return",{error:null});case 11:case"end":return n.stop()}}),n,this)}))).apply(this)},deleteFile:function(e){return(0,n.Z)(c().mark((function r(){var t,n;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,U({remove:{path:e}},{isMutative:!0});case 2:if(!(t=r.sent).error){r.next=8;break}if(n=V(t.error,[u.Df.NotFound])){r.next=7;break}throw new Error(t.error);case 7:return r.abrupt("return",{error:n});case 8:return A({eventType:u.kS.Delete,node:{path:e,type:u.Tv.File}}),r.abrupt("return",{error:null});case 10:case"end":return r.stop()}}),r)})))()},deleteDir:function(e){return(0,n.Z)(c().mark((function r(){var t,n;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,U({remove:{path:e}},{isMutative:!0});case 2:if(!(t=r.sent).error){r.next=8;break}if(n=V(t.error,[u.Df.NotFound])){r.next=7;break}throw new Error(t.error);case 7:return r.abrupt("return",{error:n});case 8:return A({eventType:u.kS.Delete,node:{path:e,type:u.Tv.Directory}}),r.abrupt("return",{error:null});case 10:case"end":return r.stop()}}),r)})))()},readDir:function(e){return(0,n.Z)(c().mark((function r(){var t,n,o,i;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=3,U({readdir:{path:e}},{isMutative:!1});case 3:if(!(n=r.sent).error){r.next=9;break}if(o=V(n.error,[u.Df.NotFound,u.Df.NotDirectory])){r.next=8;break}throw new Error(n.error);case 8:return r.abrupt("return",{error:o});case 9:if(null===(t=n.files)||void 0===t?void 0:t.files){r.next=11;break}throw new Error("Expected filesChannel");case 11:return i=n.files.files.map((function(e){if(!e.path)throw new Error("Expected path");return{filename:e.path,type:e.type===h.api.File.Type.DIRECTORY?u.Tv.Directory:u.Tv.File}})),r.abrupt("return",{children:i,error:null});case 13:case"end":return r.stop()}}),r)})))()},stat:function(e){return(0,n.Z)(c().mark((function r(){var t;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,U({stat:{path:e}},{isMutative:!1});case 2:if(!(t=r.sent).error){r.next=5;break}throw new Error(t.error);case 5:if(t.statRes){r.next=7;break}throw new Error("expected stat result");case 7:if(t.statRes.exists){r.next=9;break}return r.abrupt("return",{exists:!1});case 9:if(t.statRes.type!==h.api.File.Type.DIRECTORY){r.next=11;break}return r.abrupt("return",{exists:!0,type:u.Tv.Directory,lastModified:new Date(1e3*t.statRes.modTime)});case 11:return r.abrupt("return",{exists:!0,type:u.Tv.File,lastModified:new Date(1e3*t.statRes.modTime),byteLength:Number(t.statRes.size)});case 12:case"end":return r.stop()}}),r)})))()},watchOtFile:function(e,r){var t=this,a=C.get(e);if(a||(a={path:e,type:u.Tv.File,listeners:[],otClient:m(e)},C.set(e,a)),!a)throw new Error("Expected watchedOtFile");var s=!1,f=!1,p=function(){},d=function(o){if(p(),!a)throw new Error("Expected watchedOtFile");var i=function(e){var t;return null===(t=r.onFlush)||void 0===t?void 0:t.call(r,e)};a.otClient.on("commitComplete",i);var s=function(){var e;return null===(e=r.onStatusChange)||void 0===e?void 0:e.call(r,u.KF.Dirty)};a.otClient.on("fileDirty",s);var y=function(){var e;return null===(e=r.onStatusChange)||void 0===e?void 0:e.call(r,u.KF.Clean)};a.otClient.on("fileClean",y);var b=function(){var e;return null===(e=r.onStatusChange)||void 0===e?void 0:e.call(r,u.KF.Syncing)};a.otClient.on("commitStart",b);var k=function(e){var t;return null===(t=r.onCursor)||void 0===t?void 0:t.call(r,e)};a.otClient.on("cursor",k);var g=function(e){var t;return null===(t=r.onRemoveCursor)||void 0===t?void 0:t.call(r,e)};a.otClient.on("removeCursor",g);var w=t,x=function(){var r=(0,n.Z)(c().mark((function r(t){var n,o;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a){r.next=2;break}throw new Error("Expected watchedOtFile");case 2:return(n=a.otClient).destroy(),o=m(e),r.next=7,new Promise((function(e,r){o.once("op",(function(){var i=n.localContent,s=o.localContent,c="local"===t?(0,Z.diffStr)(s,i):null,u="remote"===t?(0,Z.diffStr)(i,s):[];if(!a)throw new Error("Expected watchedOtFile");a.otClient=o;var l=!0,f=!1,p=void 0;try{for(var d,h=a.listeners[Symbol.iterator]();!(l=(d=h.next()).done);l=!0){(0,d.value.reregister)(u)}}catch(v){f=!0,p=v}finally{try{l||null==h.return||h.return()}finally{if(f)throw p}}c&&o.writeOp(c),w.flush().then((function(){return e()})).catch(r)})),o.once("error",(function(e){return r(e)}))}));case 7:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),E=function(e){var t;return null===(t=r.onReconnectFail)||void 0===t?void 0:t.call(r,x,e)};a.otClient.on("promptUserReconnect",E),a.listeners[0].reregister===d&&a.otClient.on("promptUserReconnect",(function(){if(C.has(e)){if(!a)throw new Error("Expected watchedOtFile");a.listeners.some((function(e){return e.onReconnectFail}))||x("remote")}}));var D=function(e,t){r.onError&&r.onError(e,t),h()};a.otClient.on("error",D);var F=function(t,n){if(t===u.Df.DiskQuotaExceeded&&v({eventType:u.kS.Modify,node:{path:e,type:u.Tv.File}}),r.onError){var o=new Error(n);o.code=t,r.onError(o)}h()};a.otClient.on("fsError",F);var O,S=function(e,t){if(!a)throw new Error("Expected watchedOtFile");a.otClient.writeOp(e,t);var n=!0,o=!1,i=void 0;try{for(var s,c=a.listeners[Symbol.iterator]();!(n=(s=c.next()).done);n=!0){var l=s.value.onChange;l&&l!==r.onChange&&l({op:e,changeSource:u.Fl.Local,version:a.otClient.version,latestContent:a.otClient.localContent})}}catch(f){o=!0,i=f}finally{try{n||null==c.return||c.return()}finally{if(o)throw i}}},T=function(e){if(!a)throw new Error("Expected watchedOtFile");a.otClient.updateCursors(e)};(-1!==a.otClient.version&&setTimeout((function(){var e;if(!f){if(!a)throw new Error("Expected watchedOtFile");f=!0,null===(e=r.onReady)||void 0===e||e.call(r,{initialContent:l.Z.from(a.otClient.localContent),writeOp:S,updateSelections:T,fetchOps:a.otClient.fetchOps,transformSelection:a.otClient.transformSelection,version:a.otClient.version})}})),o)&&(null===(O=r.onChange)||void 0===O||O.call(r,{op:o,changeSource:u.Fl.Container,version:a.otClient.version,latestContent:a.otClient.localContent}));var R=function(e){var t,n;if(!a)throw new Error("Expected watchedOtFile");if(!f)return f=!0,void(null===(n=r.onReady)||void 0===n||n.call(r,{initialContent:l.Z.from(a.otClient.localContent),writeOp:S,updateSelections:T,fetchOps:a.otClient.fetchOps,transformSelection:a.otClient.transformSelection,version:a.otClient.version}));null===(t=r.onChange)||void 0===t||t.call(r,{op:e,changeSource:u.Fl.Container,version:a.otClient.version,latestContent:a.otClient.localContent})};a.otClient.on("op",R),p=function(){if(!a)throw new Error("Expected watchedOtFile");a.otClient.removeListener("commitComplete",i),a.otClient.removeListener("fileDirty",s),a.otClient.removeListener("fileClean",y),a.otClient.removeListener("commitStart",b),a.otClient.removeListener("error",D),a.otClient.removeListener("fsError",F),a.otClient.removeListener("op",R),a.otClient.removeListener("cursor",k),a.otClient.removeListener("removeCursor",g),a.otClient.removeListener("promptUserReconnect",E)},I()},h=function(){if(!s&&C.has(e)){if(s=!0,f=!0,p(),!a)throw new Error("Expected watchedOtFile");a.listeners=a.listeners.filter((function(e){return e.dispose!==h})),0===a.listeners.length&&(a.otClient.destroy(),C.delete(e))}};return a.listeners.push((0,i.Z)((0,o.Z)({},r),{dispose:h,reregister:d})),d(),h},watchFile:function(e,r){var t=!1,n=function(){t=!0;var r=E.get(e);r&&(r.listeners=r.listeners.filter((function(e){return e.dispose!==n})),0===r.listeners.length&&E.delete(e))};return H.readFile(e).then((function(a){if(!t){if(a.error){var s=new Error(a.error);return s.code=a.error,r.onError&&r.onError(s),void n()}var c=E.get(e);if(c||(c={path:e,type:u.Tv.File,listeners:[],latestContent:a.content},E.set(e,c),y&&y.send({subscribeFile:{files:[{path:e}]}})),!c)throw new Error("Expected watched file");c.listeners.push((0,i.Z)((0,o.Z)({},r),{dispose:n})),r.onChange(a.content)}})),n},listFiles:function(){return(0,n.Z)(c().mark((function e(){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(k&&window.performance.now()-g<1e4)){e.next=2;break}return e.abrupt("return",k);case 2:return b||(b=Q(),g=window.performance.now()),e.next=5,b;case 5:return r=e.sent,b=null,e.abrupt("return",r);case 8:case"end":return e.stop()}}),e)})))()},flush:function(){var e=[],r=!0,t=!1,n=void 0;try{for(var o,i=C.values()[Symbol.iterator]();!(r=(o=i.next()).done);r=!0){var s=o.value;s.otClient.isReconnecting||e.push(s.otClient.flush())}}catch(c){t=!0,n=c}finally{try{r||null==i.return||i.return()}finally{if(t)throw n}}return Promise.all((0,a.Z)(e).concat((0,a.Z)(M)).map((function(e){return e.catch((function(){}))}))).then((function(){}))},persist:function(e){var r=T();return e&&e.skipDebounce&&T.flush(),r},getOTVersion:function(e){var r=C.get(e);if(!r)throw new Error("No file with path ".concat(e," found."));return r.otClient.version},onDiskQuotaExceeded:function(e){return F.push(e),function(){F=F.filter((function(r){return r!==e}))}}};return H}},35256:function(e,r,t){t.r(r),t.d(r,{apply:function(){return d},compose:function(){return l},diffStr:function(){return h},transform:function(){return v}});var n=t(10253),o=t(82222),i=t(37529),a=t.n(i),s=function(e){return e.length>0&&"number"===typeof e[e.length-1]&&e.pop(),e},c=function(e){if(!Array.isArray(e))throw Error("Op must be an array of components");for(var r=null,t=0;t<e.length;t++){var n=e[t];switch("undefined"===typeof n?"undefined":(0,o.Z)(n)){case"object":if(!("number"===typeof n.d&&n.d>0))throw Error("Object components must be deletes of size > 0");break;case"string":if(!(n.length>0))throw Error("Inserts cannot be empty");break;case"number":if(!(n>0))throw Error("Skip components must be >0");if("number"===typeof r)throw Error("Adjacent skip components should be combined")}r=n}if("number"===typeof r)throw Error("Op has a trailing skip")},u=function(e){return"number"===typeof e?e:"string"===typeof e?e.length:e.d};function l(e,r){c(e),c(r);for(var t,n=[],i=f(n),a=p(e)[0],l=0;l<r.length;l++){var d=r[l],h=void 0,v=void 0;switch("undefined"===typeof d?"undefined":(0,o.Z)(d)){case"number":for(h=d;h>0;)(v=a(h,"d"))&&i(v),"object"!==typeof v&&(h-=u(v));break;case"string":i(d);break;case"object":for(h=d.d;h>0;)switch("undefined"===typeof(v=a(h,"d"))?"undefined":(0,o.Z)(v)){case"number":i({d:v}),h-=v;break;case"string":h-=v.length;break;case"object":v&&i(v)}}}for(;t=a(-1);)i(t);return s(n)}function f(e){return function(r){r&&0!==r.d&&(0===e.length?e.push(r):("undefined"===typeof r?"undefined":(0,o.Z)(r))===(0,o.Z)(e[e.length-1])?"object"===typeof r?e[e.length-1].d+=r.d:e[e.length-1]+=r:e.push(r))}}function p(e){var r=0,t=0;return[function(n,o){if(r===e.length)return-1===n?null:n;var i,a=e[r];return"number"===typeof a?-1===n||a-t<=n?(i=a-t,++r,t=0,i):(t+=n,n):"string"===typeof a?-1===n||"i"===o||a.length-t<=n?(i=a.slice(t),++r,t=0,i):(i=a.slice(t,t+n),t+=n,i):-1===n||"d"===o||a.d-t<=n?(i={d:a.d-t},++r,t=0,i):(t+=n,{d:n})},function(){return e[r]}]}function d(e,r){if("string"!==typeof e)throw Error("Snapshot should be a string");c(r);for(var t=[],n=0;n<r.length;n++){var i=r[n];switch("undefined"===typeof i?"undefined":(0,o.Z)(i)){case"number":if(i>e.length)throw Error("The op is too long for this document");t.push(e.slice(0,i)),e=e.slice(i);break;case"string":t.push(i);break;case"object":e=e.slice(i.d)}}return t.join("")+e}function h(e,r){if(e===r)return[];var t=[],i=function(e){e&&0!==e.d&&(0===t.length?t.push(e):("undefined"===typeof e?"undefined":(0,o.Z)(e))===(0,o.Z)(t[t.length-1])?"object"===typeof e?t[t.length-1].d+=e.d:t[t.length-1]+=e:t.push(e))};return a()(e,r).forEach((function(e){var r=(0,n.Z)(e,2),t=r[0],o=r[1];switch(t){case a().INSERT:i(o);break;case a().DELETE:i({d:o.length});break;case a().EQUAL:i(o.length)}})),t.length>0&&"number"===typeof t[t.length-1]&&t.pop(),t}function v(e,r,t){if("left"!==t&&"right"!==t)throw Error("side ("+t+") must be 'left' or 'right'");c(e),c(r);for(var i,a=[],l=f(a),d=(0,n.Z)(p(e),2),h=d[0],v=d[1],m=0;m<r.length;m++){var y=r[m],b=void 0,k=void 0;switch("undefined"===typeof y?"undefined":(0,o.Z)(y)){case"number":for(b=y;b>0;)l(k=h(b,"i")),"string"!==typeof k&&(b-=u(k));break;case"string":"left"===t&&"string"===typeof v()&&l(h(-1)),l(y.length);break;case"object":for(b=y.d;b>0;)switch("undefined"===typeof(k=h(b,"i"))?"undefined":(0,o.Z)(k)){case"number":b-=k;break;case"string":l(k);break;case"object":b-=k.d}}}for(;i=h(-1);)l(i);return s(a)}},58794:function(e,r,t){t.d(r,{Z:function(){return s}});var n=t(51438),o=t(52951),i=t(82670),a=t(48764).Buffer,s=function(){function e(r,t){if((0,n.Z)(this,e),this.asEncoding={},this.asBuffer=null,t&&"string"===typeof r)this.asEncoding[t]=r;else if(void 0===r||null===r)this.asBuffer=a.alloc(0);else if((0,i.Z)(r,a))this.asBuffer=r;else if("string"===typeof r)this.asEncoding.utf8=r;else if((0,i.Z)(r,ArrayBuffer))this.asBuffer=a.from(r);else{if((0,i.Z)(r,e))return r;(0,i.Z)(r,Uint8Array)?this.asBuffer=a.from(r):"object"!==typeof r||"object"!==typeof r.asEncoding||null===r.asEncoding||!(0,i.Z)(r.asBuffer,a)&&null!==r.asBuffer||(this.asBuffer=r.asBuffer||null,"string"===typeof r.asEncoding.base64&&(this.asEncoding={base64:r.asEncoding.base64}),"string"===typeof r.asEncoding.utf8&&(this.asEncoding={utf8:r.asEncoding.utf8}))}}var r=e.prototype;return r.toString=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"utf8";if(void 0!==this.asEncoding[e])return this.asEncoding[e];var r=this.toBuffer(),t=r.toString(e);return this.asEncoding[e]=t,t},r.toJSON=function(){return{asEncoding:{base64:this.toString("base64")},asBuffer:null}},r.toBuffer=function(){if(this.asBuffer)return this.asBuffer;for(var e in this.asEncoding){var r=this.asEncoding[e];if("string"===typeof r){var t=a.from(r,e);return this.asBuffer=t,t}}return this.asBuffer=a.alloc(0),this.asBuffer},e.from=function(r,t){return new e(r,t)},e.isBuffer=function(r){return(0,i.Z)(r,e)},(0,o.Z)(e,[{key:"length",get:function(){return void 0!==this.asEncoding.utf8?this.asEncoding.utf8.length:this.toBuffer().length}}]),e}()},15583:function(e,r,t){t.d(r,{hk:function(){return a},pC:function(){return i},yr:function(){return o}});function n(e){return""===e||e.endsWith("/")?e:e+"/"}function o(e,r){return r!==e&&r.startsWith(n(e))}function i(e,r){if(!o(e,r))return!1;var t=n(e),i=r.slice(t.length);return i.endsWith("/")&&(i=i.slice(-1)),!i.includes("/")}function a(e,r,t){var o=n(e);return n(r)+t.slice(o.length)}},10449:function(e,r,t){function n(e){throw new Error("Unhandled discriminated union member: ".concat(JSON.stringify(e)))}t.d(r,{Z:function(){return n}})},84810:function(e,r,t){t.d(r,{C:function(){return o},h:function(){return i}});var n=/^(\.env$|\.npm$|\.npm\/|__pycache__|\.cache|\.breakpoints|\.git$|\.git\/|\.upm$|\.upm\/|node_modules$|node_modules\/|_test_runner)/;function o(e){return n.test(e)}var i=[".git",".upm",".cache","__pycache__","node_modules","venv"]}}]);
//# sourceMappingURL=3576-64860bfda40fd4f9.js.map