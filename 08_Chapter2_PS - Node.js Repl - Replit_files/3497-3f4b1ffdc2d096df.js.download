(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3497],{50217:function(e,t,n){"use strict";n.d(t,{Z:function(){return f}});var r=n(47568),o=n(26042),a=n(69396),c=n(99534),i=n(34051),u=n.n(i),s=n(54098),l=n.n(s),p=n(16260),d=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/;function f(e){return v.apply(this,arguments)}function v(){return(v=(0,r.Z)(u().mark((function e(t){var n,r,i,s,f,v,g,h;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.url,r=(0,c.Z)(t,["url"]),e.prev=2,e.next=5,l()(n,{credentials:"same-origin",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},method:"post",body:JSON.stringify((0,a.Z)((0,o.Z)({},r),{format:"pbuf"}))});case 5:i=e.sent,e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(2),e.t0.statusCode=504,e.t0;case 12:if(i.ok){e.next=28;break}if(!(f=i.headers.get("content-type"))||!f.includes("application/json")){e.next=22;break}return e.next=18,i.json();case 18:v=e.sent,s=v.message,e.next=25;break;case 22:return e.next=24,i.text();case 24:s=e.sent;case 25:throw(g=new Error(s||i.statusText)).statusCode=i.status,g;case 28:return e.next=30,i.json();case 30:if((h=e.sent).token.startsWith("v2.public.")||d.test(h.token)){e.next=33;break}throw new p.Z("Expected token to be PASETO- or base64-encoded").setExtras((0,o.Z)({connectionMetadata:h,url:n},r));case 33:return e.abrupt("return",h);case 34:case"end":return e.stop()}}),e,null,[[2,8]])})))).apply(this,arguments)}},89596:function(e,t,n){"use strict";n.d(t,{d:function(){return l},h:function(){return s}});var r=n(50055),o=n(43484),a=n(34155),c=n(48764).Buffer,i=a.env.PROXY_SUFFIX||"repl.co",u=a.env.PROXY_FIREWALL_SUFFIX||"firewalledreplit.co";function s(e){var t=e.split(".");if(4!==t.length)throw new Error("Invalid token: should have exactly 4 parts: "+e);for(var n=t[2].replace(/-/g,"+").replace(/_/g,"/");n.length%4;)n+="=";var o=window.atob(n);if(o.length<64)throw new Error("Invalid token: signed part is too short: "+o.length);var a=o.substring(0,o.length-64);try{return r.api.ReplToken.decode(new c(a,"base64"))}catch(i){return JSON.parse(window.atob(a))}}function l(e){var t=s(e).repl.id,n=(0,o.Z)()?u:i,r="".concat(t,".id");return-1!==n.indexOf("repl.localhost:8080")?"ws://".concat(r,".").concat(n):"wss://".concat(r,".").concat(n)}},75240:function(e,t,n){"use strict";n.d(t,{e:function(){return k.e},Z:function(){return R}});var r=n(47568),o=n(26042),a=n(69396),c=n(99534),i=n(34051),u=n.n(i),s=n(68944),l=n(92876);function p(e){return d.apply(this,arguments)}function d(){return(d=(0,r.Z)(u().mark((function e(t){var n,r,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.client,r=t.args,o=t.env,e.abrupt("return",new Promise((function(e){var t=n.openChannel({service:"exec"},(function(n){var a=n.error,c=n.channel;if(a)e({error:a.message,output:null});else{if(!c)throw new Error("Expected channel");var i="";c.onCommand((function(e){e.output&&(i+=e.output)})),c.request({exec:{args:r,env:o}}).then((function(n){n.channelClosed?e({error:"Channel closed",output:i||null}):("open"===c.status&&t(),n.error?e({error:n.error,output:i||null}):e({output:i,error:null}))}))}}))})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var f=n(58809),v=n(55768),g=n(50217),h=n(11163),w=n.n(h),m=n(7787),C=n(34155),E=Boolean(C.env.CAPTCHA_EMBEDS);function b(e){return x.apply(this,arguments)}function x(){return(x=(0,r.Z)(u().mark((function e(t){var n,r,c,i,s,l,p,d,h;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.replId,r=t.isLoggedIn,c=t.overrideClusterMetadata,i=t.retry,s=t.asViewer,f.l){e.next=3;break}throw new Error("Expected apollo client");case 3:if(l=function(e){m.kg.error("Goval connection failure",{errorMessage:e&&e.message||"unidentified failure",replid:n,reason:"captcha",context:"services"})},p=Boolean(w().query.lite||w().query.embed),d={url:"/data/repls/".concat(n,"/get_connection_metadata"),overrideClusterMetadata:c,clientVersion:"86c14a5",hCaptchaSiteKey:v.w,isEmbed:p,flags:{},retry:i||0,asViewer:s},r||p&&!E){e.next=18;break}return e.prev=7,e.next=10,(0,v.Z)();case 10:return h=e.sent,e.abrupt("return",(0,g.Z)((0,a.Z)((0,o.Z)({},d),{captcha:h})));case 14:return e.prev=14,e.t0=e.catch(7),l(e.t0),e.abrupt("return",b({replId:n,overrideClusterMetadata:c,retry:(i||0)+1,isLoggedIn:r}));case 18:return e.abrupt("return",(0,g.Z)(d));case 19:case"end":return e.stop()}}),e,null,[[7,14]])})))).apply(this,arguments)}var k=n(18962),N=n(5133),y=n(89596);function O(){return T.apply(this,arguments)}function T(){return(T=(0,r.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof document){e.next=2;break}return e.abrupt("return");case 2:if(document.hidden){e.next=4;break}return e.abrupt("return");case 4:return e.abrupt("return",new Promise((function(e){var t=function(){document.hidden||(document.removeEventListener("visibilitychange",t),e())};document.addEventListener("visibilitychange",t)})));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Z,M=n(16260),S=n(59077),I=n(86292),A=n(99336),_=n(43484),D=n(25108),P=Math.random()<=.1;!function(e){e.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",e.PORT_OPEN="PORT_OPEN",e.TOAST="TOAST"}(Z||(Z={}));function L(e){var t=Math.floor(500*Math.random()),n=1e3*Math.pow(2,e);return Math.min(n,3e4)+t}function R(e){var t=e.onUnrecoverableError,n=e.onFirewallDenied,i=(0,N.ZP)();i.setMaxListeners(1e3);var d=null,f=k.e.DISCONNECTED,v=function(e){f!==e&&(f=e,i.emit(Z.CONNECTION_STATE_CHANGE,f))},g=function(){var e,t=function(){e&&(e(),e=void 0)};return{register:function(n,r){t();var o=n,a=r;return window.addEventListener("online",o),window.addEventListener("offline",a),e=function(){window.removeEventListener("online",o),window.removeEventListener("offline",a)},t},unregister:t}}(),h=g.register,w=g.unregister,C=new s.KU;n&&(C.onFirewallDenied=n);C.onDebugLog((function(e){if("breadcrumb"===e.type){var t;t="containerState"===e.message?{containerState:e.data}:"data"in e?e.data:void 0,A.c_.addBreadcrumb({category:"crosisV6",message:e.message,data:t}),l.n_({category:"crosisV6",message:e.message,data:t});var n={replid:null===d||void 0===d?void 0:d.repl.id,language:null===d||void 0===d?void 0:d.repl.language},r="crosis ".concat(e.message);switch(e.message){case"connect timeout":m.kg.error(r,n);break;case"retrying":var a=e.data,i=a.error,u=(0,c.Z)(a,["error"]),s=(0,o.Z)({errorMessage:i.message},n,u);m.kg.error(r,s);break;case"unrecoverable error":var p=(0,o.Z)({errorMessage:e.data.message},n);m.kg.error(r,p);break;case"connecting":case"reconnecting":case"polling fallback":m.kg.info(r,(0,o.Z)({},n,"data"in e?e.data:void 0))}}}));var E=window.location.search.includes("debug=1");return E&&C.onDebugLog((function(e){"log"===e.type&&D.log("in"===e.log.direction?"--\x3e":"<--",e.log.cmd)})),{onPortOpened:function(e){return i.on(Z.PORT_OPEN,e),function(){i.removeListener(Z.PORT_OPEN,e)}},onToast:function(e){return i.on(Z.TOAST,e),function(){i.removeListener(Z.TOAST,e)}},onConnectionStateChanged:function(e){return i.on(Z.CONNECTION_STATE_CHANGE,e),function(){i.removeListener(Z.CONNECTION_STATE_CHANGE,e)}},connect:function(e){var n=this,l=e.context,p=e.customConnectionMetadata,g=e.fetchConnectionMetadataExtras,w=(0,c.Z)(e,["context","customConnectionMetadata","fetchConnectionMetadataExtras"]);f!==k.e.DISCONNECTED&&C.close(),d=l;var x=null;h((function(){n.connect((0,o.Z)({context:l,customConnectionMetadata:p,fetchConnectionMetadataExtras:g},w))}),(function(){n.close()}));var N=this,y=function(){var e=(0,r.Z)(u().mark((function e(t){var n,r,a,c,i,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.chan0,r=t.gurl,a=t.isFirst,"open"===n.status){e.next=3;break}return e.abrupt("return");case 3:return c=m.kg.timeStart({gurl:r}),i=setTimeout((function(){m.kg.error("ping with no response",{gurl:r}),N.connect((0,o.Z)({context:l,customConnectionMetadata:p,fetchConnectionMetadataExtras:g},w))}),3e4),e.next=7,n.request({ping:{}});case 7:if(s=e.sent.channelClosed,clearTimeout(i),!s){e.next=11;break}return e.abrupt("return");case 11:a?c("latency to pid1",{type:"startup"}):P&&c("latency to pid1",{type:"periodic"}),setTimeout((function(){return y({chan0:n,gurl:r,isFirst:!1})}),1e3);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),T={getNextRetryDelayMs:L,context:l,reuseConnectionMetadata:!0,fetchConnectionMetadata:function(){var e=(0,r.Z)(u().mark((function e(t){var n,r,c,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return window.performance.clearMarks(m.Iy.fetchConnectionMetadataPageInvisibleStart),window.performance.clearMarks(m.Iy.fetchConnectionMetadataPageInvisibleEnd),n=m.kg.timeStart(),window.performance.mark(m.Iy.fetchConnectionMetadataPageInvisibleStart),e.next=7,O();case 7:window.performance.mark(m.Iy.fetchConnectionMetadataPageInvisibleEnd),n("page visible fetch connection metadata");case 9:return e.next=11,(0,S.Z)();case 11:if(r=e.sent,!t.aborted){e.next=14;break}return e.abrupt("return",{error:s.gS.Aborted});case 14:if(r||!p||x===p.token){e.next=17;break}return x=p.token,e.abrupt("return",(0,a.Z)((0,o.Z)({},p),{error:null}));case 17:if(c=m.kg.timeStart({hasCustomFetch:Boolean(w.fetchConnectionMetadata)}),e.prev=19,!w.fetchConnectionMetadata){e.next=26;break}return e.next=23,w.fetchConnectionMetadata();case 23:i=e.sent,e.next=29;break;case 26:return e.next=28,b((0,o.Z)({asViewer:l.asViewer,replId:l.repl.id,isLoggedIn:Boolean(l.currentUser),overrideClusterMetadata:r},g));case 28:i=e.sent;case 29:e.next=40;break;case 31:if(e.prev=31,e.t0=e.catch(19),!t.aborted){e.next=35;break}return e.abrupt("return",{error:s.gS.Aborted});case 35:e.t1=e.t0&&e.t0.statusCode,e.next=400===e.t1||408===e.t1||409===e.t1||429===e.t1||500===e.t1||502===e.t1||503===e.t1||504===e.t1?38:39;break;case 38:return e.abrupt("return",{error:s.gS.Retriable});case 39:throw e.t0;case 40:if(!t.aborted){e.next=42;break}return e.abrupt("return",{error:s.gS.Aborted});case 42:return E&&D.log("connecting",i),c("fetched connection metadata"),e.abrupt("return",(0,a.Z)((0,o.Z)({},i),{error:null}));case 45:case"end":return e.stop()}}),e,null,[[19,31]])})));return function(t){return e.apply(this,arguments)}}(),pollingHost:"gp-v2.replit.com"};(0,_.Z)()&&(T.pollingHost="gp-v2.firewalledreplit.com");var A=window.performance.now(),R=0;C.open(T,(function(e){var n,r=e.channel;if(e.error)return v(k.e.DISCONNECTED),function(){};if(!r)throw new Error("Expected channel");E&&D.log("connected",{replId:l.repl.id});var o=r.onCommand((function(e){switch(e.body){case"portOpen":if(!e.portOpen)throw new Error("portOpen only handles portOpen commands");if(!e.portOpen.forwarded)return;var n=e.portOpen.port||0;if(5901===n)return;(0,I.j)(I.U3.PORT_OPENED,{port:n,isVnc:5900===n}),i.emit(Z.PORT_OPEN,{port:n,isVnc:5900===n});break;case"protocolError":var r,o;t(new M.Z("goval panic").setExtra("message",null!==(o=null===(r=e.protocolError)||void 0===r?void 0:r.text)&&void 0!==o?o:"protocol error"));break;case"toast":var a,c=null===(a=e.toast)||void 0===a?void 0:a.text;if(!c)break;i.emit(Z.TOAST,c)}}));y({chan0:r,gurl:null===(n=C.getConnectionMetadata())||void 0===n?void 0:n.gurl,isFirst:!0}),window.v6ws=C.ws;var a=window.performance.now()-A;return m.kg.info("connected to pid1",{time:a,reconnectCount:R,replid:l.repl.id,language:l.repl.language}),v(k.e.CONNECTED),function(e){var t=e.willReconnect;if(o(),!t)return d=null,void v(k.e.DISCONNECTED);A=window.performance.now(),R++,v(k.e.CONNECTING)}})),v(k.e.CONNECTING)},openChannel:function(e,n){return C.openChannel(e,(function(e){var r,o=null===e||void 0===e||null===(r=e.channel)||void 0===r?void 0:r.onCommand((function(e){var n,r;"protocolError"===e.body&&t(new M.Z("goval panic").setExtra("message",null!==(r=null===(n=e.protocolError)||void 0===n?void 0:n.text)&&void 0!==r?r:"protocol error"))})),a=n(e);return function(e){a&&a(e),o&&o()}}))},getConnectionState:function(){return f},exec:(0,r.Z)(u().mark((function e(){var t,n,r,o=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=o.length,n=new Array(t),r=0;r<t;r++)n[r]=o[r];return e.abrupt("return",p({client:C,args:n}));case 2:case"end":return e.stop()}}),e)}))),execWithEnv:function(){var e=(0,r.Z)(u().mark((function e(t){var n,r,o,a=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=a.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=a[o];return e.abrupt("return",p({client:C,args:r,env:t}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),close:function(){f!==k.e.DISCONNECTED&&C.close()},destroy:function(){C.destroy(),i.removeAllListeners(),w()},client:function(){return C},getConnectionMetadata:function(){return C.getConnectionMetadata()},getContext:function(){return d},getVncUrl:function(){var e=C.getConnectionMetadata();if(!e||f!==k.e.CONNECTED)throw new Error("Cannot get vnc url when container is not connected");return(0,y.d)(e.token)},unrecoverableError:function(e,n){C.destroy(),i.removeAllListeners(),t(n?M.Z.wrap(e).setExtras(n):e)}}}},18962:function(e,t,n){"use strict";var r;n.d(t,{e:function(){return r}}),function(e){e.CONNECTING="CONNECTING",e.CONNECTED="CONNECTED",e.DISCONNECTED="DISCONNECTED"}(r||(r={}))},59077:function(e,t,n){"use strict";n.d(t,{Z:function(){return p},t:function(){return l}});var r=n(47568),o=n(34051),a=n.n(o),c=n(35642),i=(n(54098),n(25108));function u(){return s.apply(this,arguments)}function s(){return(s=(0,r.Z)(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c.Z.get("gurl")){e.next=3;break}return i.log("Getting gurl from localstorage"),e.abrupt("return",c.Z.get("gurl"));case 3:e.next=5;break;case 5:return e.abrupt("return",null);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function l(e){var t=function(e){var t;try{t=new URL(e)}catch(r){return i.log("failed to parse gurl"),i.error(r),null}var n={secure:!1,port:""+t.port,host:t.hostname};return"wss:"===t.protocol?n.secure=!0:"ws:"!==t.protocol&&i.log(e,"Expected gurl protocol to be ws or wss, assuming insecure connection"),n.port||(n.port=n.secure?"443":"80"),n}(e);if(!t)return null;var n=t.secure,r=t.host,o=t.port;return"eval.repl.it"===r||"gp-v2.replit.com"===r||"gp-v2.firewalledreplit.com"===r||"eval.replit.com"===r?null:{id:"development",gurl:"ws".concat(n?"s":"","://").concat(r,":").concat(o),conmanURL:"http".concat(n?"s":"","://").concat(r,":").concat(o),proxy:"http".concat(n?"s":"","://").concat(r.replace("eval","proxy"),":").concat(o)}}function p(){return d.apply(this,arguments)}function d(){return(d=(0,r.Z)(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u();case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return",null);case 5:return e.abrupt("return",l(t));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},77020:function(){}}]);
//# sourceMappingURL=3497-3f4b1ffdc2d096df.js.map